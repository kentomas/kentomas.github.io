# Logging in .NET Core and ASP.NET Core

This article is an abstract of the information provided in [Logging in .NET Core and ASP.NET Core](https://learn.microsoft.com/en-us/aspnet/core/fundamentals/logging/?view=aspnetcore-7.0).


## Log Levels

| LogLevel      | Value | Method         | Description                                                                                                                                                        |
| ------------- | ----- | -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `Trace`       | 0     | LogTrace       | Contain the most detailed messages. These messages may contain sensitive app data. These messages are disabled by default and should not be enabled in production. |
| `Debug`       | 1     | LogDebug       | For debugging and development. Use with caution in production due to the high volume.                                                                              |
| `Information` | 2     | LogInformation | Tracks the general flow of the app. May have long-term value.                                                                                                      |
| `Warning`     | 3     | LogWarning     | For abnormal or unexpected events. Typically includes errors or conditions that don't cause the app to fail.                                                       |
| `Error`       | 4     | LogError       | For errors and exceptions that cannot be handled. These messages indicate a failure in the current operation or request, not an app-wide failure.                  |
| `Critical`    | 5     | LogCritical    | For failures that require immediate attention. Examples: data loss scenarios, out of disk space.                                                                   |
| `None`        | 6     |                | Specifies that a logging category shouldn't write messages.                                                                                                        |


## Logging providers

- Logging providers store logs, except for the Console provider which displays logs.
  - For example, Azure Application Insights provider stores logs in Azure Application Insights.
- Multiple providers can be enabled.

The default ASP.NET Core web app templates:

- Use the `Generic Host`.
- Call `WebApplication.CreateBuilder`, which adds the following logging providers:
    - `Console`
    - `Debug`
    - `EventSource`
    - `EventLog`: Windows only

Third-Party Logging providers:

- Azure

## Log Category

- A log category refers to a way of categorizing and organizing log messages generated by the application.
- Log categories allow developers to filter log messages based on the type of information being logged, such as errors, warnings, or informational messages. This can be useful for troubleshooting and debugging, as well as for monitoring the overall health and performance of the application.
- Log categories can be defined by the developer and can be used with various logging frameworks, such as log4net or the built-in tracing and logging features of ASP.NET.
- When an `ILogger` object is created, a category is specified.
  - That category is included with each log message created by that instance of `ILogger`.
  - The category string is arbitrary, but the convention is to use the class name.
    - For example, in a controller the name might be `"TodoApi.Controllers.TodoController"`.
    - The ASP.NET Core web apps use `ILogger<T>` to automatically get an ILogger instance that uses the fully qualified type name of T as the category:

``` cs title="C#" hl_lines="2 6 8"
// FILE: PrivacyModel.cs
namespace TodoApi.Models
{
  public class PrivacyModel : PageModel
  {
    private readonly ILogger<PrivacyModel> _logger;

    public PrivacyModel(ILogger<PrivacyModel> logger)
    {
        _logger = logger;
    }

    public void OnGet()
    {
        _logger.LogInformation("GET Pages.PrivacyModel called.");
    }
  }
}
```

``` json title="JSON" hl_lines="7"
// FILE: appsettings.json
{
  "Logging": {
    "LogLevel": {
         "Default": "Information",
         "Microsoft.AspNetCore": "Warning",
         "TodoApi.Models.PrivacyModel" : "Warning"
    }
  }
}
```

## Configure Logging

- Logging configuration is commonly provided by the Logging section of `appsettings.json`.
- The `Logging` property can have `LogLevel` and log provider properties.
- The `LogLevel` specifies the `minimum level to log` for selected categories.

```json title="JSON - Default Logging Configuration"
{
  "Logging": {
    "LogLevel": {
         "Default": "Information",
         "Microsoft.AspNetCore": "Warning"
    }
  }
}
```

In the JSON:

- The `"Default"` and `"Microsoft.AspNetCore"` are logging `categories`.
- The `"Microsoft.AspNetCore"` `category` applies to all categories that start with `"Microsoft.AspNetCore"`.
  - For example, this setting applies to the `"Microsoft.AspNetCore.Routing.EndpointMiddleware"` category.
- The `"Microsoft.AspNetCore"` `category` logs at `log level` `Warning` and higher.
- A specific log provider is not specified, so `LogLevel` applies to all the enabled logging providers except for the Windows EventLog.

### Environment Variable

For logging, we're going to use different `appsettings.json` files to manage the applications logging.

We will use:

- `Development`: appsettings.json
- `Staging`: appsettings.staging.json
- `Production`: appsettings.production.json

### Console

The Console provider logs output to the console.

> NOTE: Remember to update `appsettings.json` to ensure the `classes` with logging are visible.

``` cs title="C#"
// FILE: Program.cs
var builder = WebApplication.CreateBuilder(args);
builder.Logging.AddConsole();
```



## Log Event ID

## Log Message Template

## Log Exceptions

## ASP.NET Core and EF Core Categories

## Log Scopes

## Built-in Logging Providers

## Third-party Logging Providers

### Azure Insights?

## Change log levels in a running app

## ASP.NET Core

The default ASP.NET Core web app templates:

- Use the `Generic Host`.
- Call WebApplication.CreateBuilder, which adds the following logging providers:
  - `Console`
  - `Debug`
  - `EventSource`
  - `EventLog`: Windows only

**Exception handler page**
To configure a custom error handling page for the Production environment, call UseExceptionHandler. This exception handling middleware:

- Catches and logs unhandled exceptions.
- Re-executes the request in an alternate pipeline using the path indicated. The request isn't re-executed if the response has started. The template-generated code re-executes the request using the /Error path.

```cs title="C# - Default implementation " linenums="1" hl_lines="4 6"

// FILE: Program.cs
var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
    app.UseHsts();
}

```

```cs title="C# - Sample"

using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;

namespace LogDataGenerator.Controllers.api
{
    [ApiController]
    [Route("[controller]")]
    public class GenerateController : ControllerBase
    {
        private readonly ILogger<GenerateController> _logger;

        public GenerateController(ILogger<GenerateController> logger)
        {
            this._logger = logger;
        }

        // GET: GenerateController
        public JS Get()
        {
            _logger.LogInformation("GenerateController page visited at {DT}", DateTime.UtcNow.ToLongTimeString());

            return "Success";
        }
    }
}

```

## Generic Host

## References

- [https://learn.microsoft.com/en-us/aspnet/core/fundamentals/logging/?view=aspnetcore-7.0](https://learn.microsoft.com/en-us/aspnet/core/fundamentals/logging/?view=aspnetcore-7.0)
